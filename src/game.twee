:: StoryTitle
Psychotlenij


:: StoryData
{
  "ifid": "5F7DC4B3-1596-4203-B4E4-490A46154FFC",
  "format": "SugarCube",
  "format-version": "2.37.3",
  "start": "Начало",
  "zoom": 1
}


:: StoryInit
<<script>>
  // @ts-check

  const ArrayExt = {
    /**
     * @template T
     * @template U
     * @param {T[]} arr
     * @param {(item: T) => U} projection
     * @returns {T[]}
     */
    getFirstDuplicates(arr, projection) {
      if (arr.length === 0) {
        throw new Error('Array is empty!')
      }

      const first = projection(arr[0])
      const result = []

      for (const item of arr) {
        if (projection(item) === first) {
          result.push(item)
        } else {
          break
        }
      }
      return result
    }
  }

  /** @typedef {"adequacy" | "inadequacy" | "capitalism" | "tlenost"} CharacteristicName */

  const CharacteristicName = {
    /**
     * @param {CharacteristicName} name
     */
    getOrder(name) {
      switch (name) {
        case "adequacy": return 4
        case "inadequacy": return 3
        case "capitalism": return 2
        case "tlenost": return 1
        default: return 0
      }
    }
  }

  /** @typedef {{ name: CharacteristicName, value: number }} Characteristic */

  /**
   * @param {Characteristic[]} characteristics
   */
  function getTopCharacteristic(characteristics) {
    if (!Array.isArray(characteristics) || characteristics.length === 0) {
      throw new Error('Array is empty!')
    }

    const byValueDesc = [...characteristics].sort((a, b) => b.value - a.value)
    const topValueGroup = ArrayExt.getFirstDuplicates(byValueDesc, x => x.value)
    const byOrderDesc = topValueGroup.sort(
      (a, b) => CharacteristicName.getOrder(b.name) - CharacteristicName.getOrder(a.name)
    )
    return byOrderDesc[0]
  }

  function testGetTopCharacteristic() {
    {
      const result = getTopCharacteristic([
        { name: "adequacy", value: 1 },
        { name: "tlenost", value: 4 },
        { name: "capitalism", value: 3 },
        { name: "inadequacy", value: 2 },
      ])
      console.log(result.name === "tlenost" && result.value === 4)
    }

    {
      const result = getTopCharacteristic([
        { name: "adequacy", value: 0 },
        { name: "inadequacy", value: 2 },
        { name: "capitalism", value: 2 },
        { name: "tlenost", value: 1 },
      ])
      console.log(result.name === "inadequacy" && result.value === 2)
    }

    {
      const result = getTopCharacteristic([
        { name: "adequacy", value: 2 },
        { name: "inadequacy", value: 2 },
        { name: "capitalism", value: 1 },
        { name: "tlenost", value: 2 },
      ])
      console.log(result.name === "adequacy" && result.value === 2)
    }
  }

  // testGetTopCharacteristic()

  window["getTopCharacteristic"] = getTopCharacteristic
<</script>>
<<set $adequacy to 0>>
<<set $inadequacy to 0>>
<<set $capitalism to 0>>
<<set $tlenost to 0>>


:: Начало
! Психотленный

Текстовая игра про Нетленного, который отправился в психдиспансер, чтобы добыть себе немного...

[[Начать игру]]


:: Начать игру

Ты — Павел «Нетленный» Петров и сегодня ты набрался смелости, чтобы сходить в психдиспансер. О нет, ты совсем не сумасшедший. Ты — гений, который замыслил идеальный план, чтобы добыть немного себе [[его->Узнать о VR]].


:: Узнать о VR

Нет, это не что-то запрещенное, как можно было подумать. Это вполне себе распространенный продукт, который можно [[купить|Купить VR]] на любом маркетплейсе.


:: Купить VR
Конечно, ты можешь его купить со своими <<link "десятью работами">>
  <<script>>
    Dialog.setup("10 работ");
    Dialog.wiki("Да, ты действительно работаешь на десяти работах. Как тебе это удается? Ну, очень просто: у обычного человека максимум 250IQ, а у тебя их — целых 3000IQ! Поэтому ты с легкостью умеешь обманывать других. Интервью окончено.");
    Dialog.open();
  <</script>>
<</link>> и легким <<link "фармом денег">>
  <<script>>
    Dialog.setup("Фарм денег");
    Dialog.wiki("Ну, ты иногда поигрываешь в \"Веселую ферму\", а кто не поигрывает?");
    Dialog.open();
  <</script>>
<</link>>, которые и не снились <<link "нищебродам">>
  <<script>>
    Dialog.setup("Нищеброд");
    Dialog.wiki("Так ты нежно называешь всех вокруг (потому что ты — самый умный, конечно же).");
    Dialog.open();
  <</script>>
<</link>> твоей страны, но ты, как последовательный капиталист, очень любишь получать деньги, а не тратить. А еще ты любишь получать [[подарки->О подарках]].


:: О подарках
У тебя много друзей — это твой главный капитал. К ним ты можешь обратиться.

* [[Обратиться к мужику в шляпе]]
* [[Обратиться к европейской принцессе]]
* [[Обратиться к своему преданному ненавистнику]]
* [[Махнуть на всех рукой]]

:: Обратиться к мужику в шляпе
<<set $capitalism to $capitalism + 1>>
/* todo: написать текст */
[[Почитать газетку]]


:: Обратиться к европейской принцессе
<<set $tlenost to $tlenost + 1>>Все они, конечно, ненавистники и жестокие тираны твоей души, но среди них есть одна добрая европейская принцесса. Не сказать, что она добрая, просто упрямая. Поэтому она всё еще не подарила тебе вожделенный технологический продукт. Однажды это, конечно, случится, но пока что приходится рассчитывать только на свою [[гениальность->Почитать газетку]].


:: Обратиться к своему преданному ненавистнику
<<set $inadequacy to $inadequacy + 1>>
/* todo: написать текст */
[[Почитать газетку]]


:: Махнуть на всех рукой
<<set $adequacy to $adequacy + 1>>
/* todo: написать текст */
[[Почитать газетку]]


:: Почитать газетку
Однажды утром твоя гениальность вычитала в <<link "местной газете">>
  <<script>>
    Dialog.setup("Чтение газет");
    Dialog.wiki("Да, ты всё еще читаешь газеты, потому что экономишь... Ладно, ты забыл оплатить интернет.");
    Dialog.open();
  <</script>>
<</link>>, что психиатры твоего родного города П лечат <<link "депрессию и творожные расстройства">>
  <<script>>
    Dialog.setup("Твое блестящее психическое состояние");
    Dialog.wiki("В ту минуту ты очень сильно пожалел, что абсолютно психически здоров.");
    Dialog.open();
  <</script>>
<</link>> с помощью [[этой штуки->Пустить слюну]].

:: Пустить слюну
Тебя всегда интересовало, как ведет себя собака Павлова, когда смотрит на свет. Теперь ты это узнал.
<img src="data:image/webp;base64,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" alt="pepedrool.webp">
На газете почему-то образовалось [[мокрое пятно->Выбросить газету]].


:: Выбросить газету
Газетка улетает в урну. Ты разваливаешься на своем любимом кресле, надеваешь шапочку из фольги и придумываешь план. Осталось его только [[воплотить->Воплотить план]].


:: Воплотить план
Утром ты берешь с собой два пирожка с капустой и [[отправляешься на дело->Занять свободное место в маршрутке]].


:: Занять свободное место в маршрутке
/* todo: дописать */
* [[Побежать наперегонки]]
* [[Купить место за пирожок]]
* [[Просто уступить]]
* [[Задуматься о бренности бытия]]


:: Купить место за пирожок
/* todo: дописать */
<<set $capitalism to $capitalism + 1>>
[[Выйти на остановке]]


:: Задуматься о бренности бытия
/* todo: дописать */
<<set $tlenost to $tlenost + 1>>
[[Выйти на остановке]]


:: Побежать наперегонки
/* todo: дописать */
<<set $inadequacy to $inadequacy + 1>>
[[Выйти на остановке]]


:: Просто уступить
/* todo: дописать */
<<set $adequacy to $adequacy + 1>>
[[Выйти на остановке]]


:: Выйти на остановке
По дороге с тобой ничего не приключается, но приходится пожертвовать <<link "раздавленными всмятку пирожками">>
  <<script>>
    Dialog.setup("Раздавленные пирожки");
    Dialog.wiki("Пришлось побороться за свободное место в общественном транспорте. Ну, потому что ты очень устаешь на своих 10 работах, а 3000IQ требует с тебя очень много калорий.");
    Dialog.open();
  <</script>>
<</link>>. Ты робко заходишь психдиспансер. На секунду тебе кажется, что план не такой блестящий. Но ты быстро берешь себя в руки и [[подходишь к регистратуре->Подойти к регистратуре]].


:: Подойти к регистратуре
Дама из регистратуры смотрит на тебя.

* [[Выяснить цену вопроса]]
* [[Засомневаться]]
* [[Пустить слюну]]
* [[Записаться к врачу]]


:: Выяснить цену вопроса
<<set $capitalism to $capitalism + 1>>
/* todo: дописать */
/* Лечение у нас бесплатное, конечно, но для вас сделаем скидку. */
[[Занять очередь]]


:: Засомневаться
<<set $tlenost to $tlenost + 1>>Ты начинаешь убеждать себя и заодно даму в регистратуре, что тебе срочно, вот прям сейчас нужна помощь. Когда она тянется к трубке от телефона, не отрывая от тебя понимающего взгляда, до тебя начинает доходить, что план, придуманный за наносекунду, надо было придумать как минимум за две. Впрочем, она дает тебе талон, и ты [[занимаешь очередь->Занять очередь]] в нужный кабинет.


:: Пустить слюну
<<set $inadequacy to $inadequacy + 1>>
/* todo: дописать */
[[Занять очередь]]


:: Записаться к врачу
<<set $adequacy to $adequacy + 1>>
/* todo: дописать */
[[Занять очередь]]


:: Занять очередь
Конечно же, ни одна очередь не обходится без бабули, желающей присесть тебе на уши.

* [[Заявить, что ты — перформанс артист]]
* [[Пересесть]]
* [[Выслушать]]
* [[Раскритиковать совковое мышление]]


:: Выслушать
<<set $tlenost to $tlenost + 1>>
/* todo */
[[Остановить ятолькоспросильщика]]


:: Заявить, что ты — перформанс артист
<<set $inadequacy to $inadequacy + 1>>
/* todo */
[[Остановить ятолькоспросильщика]]


:: Пересесть
<<set $adequacy to $adequacy + 1>>
/* todo */
[[Остановить ятолькоспросильщика]]


:: Раскритиковать совковое мышление
<<set $capitalism to $capitalism + 1>>Ты быстро распознаешь в ней совкое мышление и атакуешь первым. Твои бесконечные споры в тырнетах закалили тебя настолько, что любая контратака пролетает мимо тебя, а твой капитализм попадает сердобольной старушке прямо в сердце. Кажется, ты ей нравишься своей дерзостью: она залихватски ухмыляется и бросает на прощанье: "Мы еще с тобой встретимся, милок". Больше ты никогда ее не видел.

А еще ты наблюдаешь, как [[кто-то щемится вне очереди->Остановить ятолькоспросильщика]].


:: Остановить ятолькоспросильщика

Ты останавливаешь его тем же вопросом, что и своих последователей: "Почему ты сейчас заходишь?"

"А действительно, почему?" — это последнее, что ты от него слышишь.

Наконец подходит твой черед, и ты [[тянешь ручку двери->Зайти к врачу]].


:: Зайти к врачу
Дама средних лет в белом халате спрашивает тебя: «На что жалуемся?»

[[Пожаловаться]]


:: Пожаловаться
<<nobr>>
  <<set $result to getTopCharacteristic([
    { name: "adequacy", value: $adequacy },
    { name: "inadequacy", value: $inadequacy },
    { name: "capitalism", value: $capitalism },
    { name: "tlenost", value: $tlenost },
  ])>>
  <<if $result.name === "adequacy">>
    <<include "Симулянт (концовка)">>
  <<elseif $result.name === "inadequacy">>
    <<include "Псих (концовка)">>
  <<elseif $result.name === "capitalism">>
    <<include "Безумие заразительно (концовка)">>
  <<elseif $result.name === "tlenost">>
    <<include "Тревоги есть у всех (концовка)">>
  <</if>>
<</nobr>>


:: Тревоги есть у всех (концовка)
Ты начинаешь тревожится, что не сможешь купить Radeon RTX 5090 и что тебя могут уволить с одной из 10 работ. По утрам ты встаешь вялый и делать ничего не хочешь (и 10 работ совсем не при чем). Иногда тебя одолевает внезапный страх (совершенно несвязанный со смелыми высказываниями в тырнетах) и учащается сердцебиение.

Врач с пониманием кивает и выписывает тебе целебный курс с применением новейшей технологии. Ты наконец получаешь вожделенный VR. Но, как и всё в этом мире, он тебе не нравится.

После своих злоключений, ты строчишь разочарованный обзор в чатике и продолжаешь жить своей жизнью, полной страхов и тревог в лоне безответного понимания капитализма.

Получена концовка «Тревоги есть у всех».


:: Симулянт (концовка)
Ты пытаешься и так, и этак изображать из себя встревоженного гражданина своей необъятной, но тебя подводит воображение. Врачиха ставит тебе пометку «Годен» и отправляет восвояси. План, придуманный за наносекунду, точно не мог подвести. Скорее всего, ты слишком мало набрался сегодня впечатлений.

Получена концовка «Симулянт».


:: Псих (концовка)
Ты настолько правдоподобно расписываешь свое внутреннее беспокойство, что оно бурным потоком прорывается во внешнюю среду. Врачиха быстрым росчерком рисует тебе диагноз и зовет санитаров. Конечно, ты получаешь вожделенный VR на постоянной основе, но он тебе совершенно не нравится!
/* todo: и музыка из Ералаша "парам-пам" */
Получена концовка «Псих».


:: Безумие заразительно (концовка)
Сегодня ты особенно хорошо преуспеваешь в распространении капитализма и уже не можешь остановиться. Ты обрушиваешь на врачиху свой бесконечный аналитический монолог: про обстановку своей необъятной; про нищету, которая не может никак научится считать сложные проценты; про экономические пузыри; про амортизацию; про мегакорпорации; про зло монополий и т.д, и т.п. Врачиха теряется от такого бурного потока противоречивой, разрозненной информации. Ты слышишь, как ее шестеренки начинают скрипеть. Ты видишь, как ее глаз начинает дергаться, а пар выходить из ушей. Она начинает глупо и истерично смеяться. Ты и сам удивляешься своему тлетворному влиянию на окружающих. Впрочем, тебе это никак не помогает: врачиху увозят на покой, а день объявляют не приемным.

Получена концовка «Безумие заразительно».
